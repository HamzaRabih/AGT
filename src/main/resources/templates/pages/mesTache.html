<!DOCTYPE html>

<!-- =========================================================
* Sneat - Bootstrap 5 HTML Admin Template - Pro | v1.0.0
==============================================================

* Product Page: https://themeselection.com/products/sneat-bootstrap-html-admin-template/
* Created by: ThemeSelection
* License: You must have a valid license purchased in order to legally use the theme for your project.
* Copyright ThemeSelection (https://themeselection.com)

=========================================================
 -->
<!-- beautify ignore:start -->
<html
        lang="en"
        class="light-style layout-menu-fixed"
        dir="ltr"
        data-theme="theme-default"
        data-assets-path="../assets/"
        data-template="vertical-menu-template-free"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout.html}"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
<head>
  <meta charset="utf-8" />
  <meta
          name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
  />

  <title>Do-it4me</title>

  <meta name="description" content="" />

  <!--notif Js-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="img/LDFLOGO.png" />

  <!-- Data table ikns-->
  <link href="css/datatables.min.css" rel="stylesheet">

  <!-- Icons. Uncomment required icon fonts -->
  <link rel="stylesheet" href="css/boxicons.css" />
  <link rel="stylesheet" href="css/boxicons.css" />

  <!-- Core CSS -->
  <link rel="stylesheet" href="css/core.css" class="template-customizer-core-css" />
  <link rel="stylesheet" href="css/theme-default.css" class="template-customizer-theme-css" />
  <link rel="stylesheet" href="css/demo.css" />


  <!-- Vendors CSS -->
  <link rel="stylesheet" href="css/perfect-scrollbar.css" />

  <link rel="stylesheet" href="css/apex-charts.css" />

  <!-- Page CSS -->
  <link rel="stylesheet" href="css/myCss.css" />

  <!-- Helpers -->
  <script src="js/helpers.js"></script>

  <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
  <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
  <script src="js/config.js"></script>
</head>
<style>
    /* Réduisez la largeur de l'entrée de recherche */
  div.dataTables_wrapper div.dataTables_filter input {
    width: 122px; /* Ajustez la largeur selon vos besoins */
    margin-top: 5px;!important; /* Ajustez la largeur selon vos besoins */
    color: #5A8DEE!important;
  }
</style>
<body>

<section layout:fragment="content">


  <!-- content div-->
  <div class="container-fluid h-auto m-0">
    <div class="content-wrapper">
      <!-- Content -->
      <div class="container-xxl flex-grow-1 " STYLE="padding-top: 0px;margin-top: 2px;padding:0px;">
        <div class="row">
          <div class="col-md-12">
            <!-- Basic Bootstrap Table -->
            <div class="card ">
              <div class="card-body p-sm-3">
                <div class="table-responsive text-nowrap">
                  <div class="row">

                    <!--filtre-->
                    <div class="d-flex align-items-center justify-content-start flex-nowrap pr-0 pl-0">
                      <div class="d-flex align-items-center mr-2" style="margin-right: 10px!important;">
                        <label for="membreSelect" class="form-label-sm my-primary" style="margin-right: 5px; font-weight: 700;">Récepteur</label>
                        <select id="membreSelect" class="form-select form-select-sm Mycolor">
                          <option value="" selected="selected">Tout sélectionner</option>
                          <option th:each="p:${Recepteurs}" th:value="${p.idutilisateur}" th:text="${p.prenom + ' ' + p.nom}"></option>
                        </select>
                      </div>

                      <div class="d-flex align-items-center mr-2"  style="margin-right: 10px!important;">
                        <label for="etapeSelect" class="form-label-sm my-primary" style="margin-right: 5px; font-weight: 700;">Étape</label>
                        <select id="etapeSelect" class="form-select form-select-sm Mycolor">
                          <option value="" selected="selected">Tout sélectionner</option>
                          <option value="Aucune">Aucune</option>
                          <option value="Prospection" >Prospection</option>
                          <option value="Cadrage">Cadrage</option>
                          <option value="Livraison">Livraison</option>
                          <option value="Embauche">Embauche</option>
                          <option value="Encaissement">Encaissement</option>
                          <option value="Suivi">Suivi</option>
                          <option value="Formation">Formation</option>
                          <option value="Conseil">Conseil</option>
                        </select>
                      </div>

                      <div class="d-flex align-items-center mr-2"  style="margin-right: 10px!important;">
                        <label for="statutSelect" class="form-label-sm my-primary" style="margin-right: 5px; font-weight: 700;">Statut</label>
                        <select id="statutSelect" class="form-select form-select-sm Mycolor">
                          <option value="" selected="selected">Tout sélectionner</option>
                          <option value="Validée">Validé</option>
                          <option value="Terminée">Terminé</option>
                          <option value="En cours">En cours</option>
                          <option value="En attente">En attente</option>
                          <option value="Programmée">Programmé</option>
                          <option value="À refaire">À refaire</option>
                          <option value="Annulée">Annulé</option>
                        </select>
                      </div>


                      <div class="d-flex align-items-center mr-2"  style="margin-right: 10px!important;">
                        <label class="form-label-sm my-primary" style="margin-right: 5px; font-weight: 700;">Date</label>
                        <select id="dateSelected" class="form-select form-select-sm Mycolor">
                          <option value="ouverture" selected="selected"> Date ouverture</option>
                          <option value="objectif"> Date objectif</option>
                          <option value="cloture"> Date clôture</option>
                        </select>
                      </div>

                      <div class="d-flex align-items-center mr-2"  style="margin-right: 10px!important;">
                        <label for="dateMinSelect" class="form-label-sm my-primary" style="margin-right: 5px; font-weight: 700;">De</label>
                        <input class="form-control form-control-sm Mycolor" type="date" id="dateMinSelect">
                      </div>

                      <div class="d-flex align-items-center mr-2"  style="margin-right: 10px!important;">
                        <label for="dateMaxSelect" class="form-label-sm my-primary" style="margin-right: 5px; font-weight: 700;">À</label>
                        <input class="form-control form-control-sm Mycolor" type="date" id="dateMaxSelect">
                      </div>

                      <div class="d-flex align-items-center mr-2"  style="margin-right: 10px!important;">
                        <label for="rechercher" class="form-label-sm my-primary" style="margin-right: 5px; font-weight: 700;">Rechercher</label>
                        <input class="form-control form-control-sm Mycolor" type="text" id="rechercher">
                      </div>
                    </div>
                    <!--/filtre-->
                    <table id="example" style="width:100%" class="table table-bordered table-sm table-secondary ">
                      <thead>
                      <tr>
                        <th  style="width: 100%;"
                             class="text-center  Mycolor"
                             data-bs-toggle="tooltip"
                             data-bs-offset="0,4"
                             data-bs-placement="top"
                             data-bs-html="true"
                             title="<span>Tâches</span>">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                               class="bi bi-list-task" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                  d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5zM3 3H2v1h1z"/>
                            <path d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"/>
                            <path fill-rule="evenodd"
                                  d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5zM2 7h1v1H2zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm1 .5H2v1h1z"/>
                          </svg>
                          <label class="capitalize-first">Tâches</label>
                          <!--Tache-->
                        </th>
                        <th class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>Étape</span>"
                        > <!--Étape-->
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bar-chart-steps" viewBox="0 0 16 16">
                            <path d="M.5 0a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-1 0V.5A.5.5 0 0 1 .5 0M2 1.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5zm2 4a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5zm2 4a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-6a.5.5 0 0 1-.5-.5zm2 4a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5z"/>
                          </svg>
                        </th>
                        <th class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>Émetteur</span>"
                        > <!--émetteur-->
                          <svg style="margin-right: 0;margin-left: 0;"
                               xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                               class="bi bi-send-fill" viewBox="0 0 16 16">
                            <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471z"/>
                          </svg>
                        </th>
                        <th class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>Status</span>"><!--Status-->
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                               class="bi bi-check-circle-fill" viewBox="0 0 16 16">
                            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                          </svg>
                        </th>
                        <th class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>Durée retardée</span>"><!--dure retarde-->
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                               class="bi bi-calendar-x" viewBox="0 0 16 16">
                            <path d="M6.146 7.146a.5.5 0 0 1 .708 0L8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 0 1 0-.708"/>
                            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
                          </svg>
                        </th>
                        <th class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>Performance</span>"
                        > <!--performance-->
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                               class="bi bi-battery-charging" viewBox="0 0 16 16">
                            <path d="M9.585 2.568a.5.5 0 0 1 .226.58L8.677 6.832h1.99a.5.5 0 0 1 .364.843l-5.334 5.667a.5.5 0 0 1-.842-.49L5.99 9.167H4a.5.5 0 0 1-.364-.843l5.333-5.667a.5.5 0 0 1 .616-.09z"/>
                            <path d="M2 4h4.332l-.94 1H2a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h2.38l-.308 1H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2"/>
                            <path d="M2 6h2.45L2.908 7.639A1.5 1.5 0 0 0 3.313 10H2zm8.595-2-.308 1H12a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H9.276l-.942 1H12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/>
                            <path d="M12 10h-1.783l1.542-1.639q.146-.156.241-.34zm0-3.354V6h-.646a1.5 1.5 0 0 1 .646.646M16 8a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8"/>
                          </svg>
                        </th>
                        <th class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>progression</span>"><!--progression-->
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-battery-half" viewBox="0 0 16 16">
                            <path d="M2 6h5v4H2z"/>
                            <path d="M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8"/>
                          </svg>
                        </th>
                        <th class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>Id tâche</span>"
                        > <!--idTache-->
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                               class="bi bi-key-fill" viewBox="0 0 16 16">
                            <path d="M3.5 11.5a3.5 3.5 0 1 1 3.163-5H14L15.5 8 14 9.5l-1-1-1 1-1-1-1 1-1-1-1 1H6.663a3.5 3.5 0 0 1-3.163 2M2.5 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                          </svg>
                        </th>
                        <th style="margin-right: 0;margin-left: 0;"
                            class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>Priorité</span>"><!--Priorité-->
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                               class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">
                            <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
                          </svg>
                        </th>
                        <th class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>Date ouverture</span>"
                        ><!--date ouverture-->
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                               class="bi bi-envelope-open" viewBox="0 0 16 16">
                            <path d="M8.47 1.318a1 1 0 0 0-.94 0l-6 3.2A1 1 0 0 0 1 5.4v.817l5.75 3.45L8 8.917l1.25.75L15 6.217V5.4a1 1 0 0 0-.53-.882zM15 7.383l-4.778 2.867L15 13.117zm-.035 6.88L8 10.082l-6.965 4.18A1 1 0 0 0 2 15h12a1 1 0 0 0 .965-.738ZM1 13.116l4.778-2.867L1 7.383v5.734ZM7.059.435a2 2 0 0 1 1.882 0l6 3.2A2 2 0 0 1 16 5.4V14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5.4a2 2 0 0 1 1.059-1.765z"/>
                          </svg>
                        </th>
                        <th class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>Date objectif</span>"
                        ><!--date objectif-->
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                               class="bi bi-calendar4-event" viewBox="0 0 16 16">
                            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1zm13 3H1v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"/>
                            <path d="M11 7.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z"/>
                          </svg>
                        </th>
                        <th class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>Durée estimée</span>"
                        ><!--dure estime-->
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                               class="bi bi-hourglass-split" viewBox="0 0 16 16">
                            <path d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.351z"/>
                          </svg>
                        </th>
                        <th class="text-center Mycolor"
                            data-bs-toggle="tooltip"
                            data-bs-offset="0,4"
                            data-bs-placement="top"
                            data-bs-html="true"
                            title="<span>Date clôture</span>"
                        ><!--date clôture -->
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                               class="bi bi-calendar-check-fill" viewBox="0 0 16 16">
                            <path d="M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4zM16 14V5H0v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2m-5.146-5.146-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708"/>
                          </svg>
                        </th>
                      </tr>
                      </thead>
                      <tbody class="table-border" id="tbody1"></tbody>
                    </table>
                  </div>
                </div>
                <!--/ Basic Bootstrap Table -->

                <!-- / Content -->


                <div class="content-backdrop fade"></div>
              </div>
              <!-- Content wrapper -->
            </div>
            <!-- / Layout page -->
          </div>
          <!-- /content-->
        </div>
        <!--/ content div-->
      </div>
    </div>
  </div>

<!-- les scripte du tamplet JS -->
<!-- build:js assets/vendor/js/core.js -->
<script src="js/popper.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/perfect-scrollbar.js"></script>
<script src="js/menu.js"></script>
<!-- endbuild -->
<!-- Vendors JS -->
<script src="js/apexcharts.js"></script>
<!-- Main JS -->
<script src="js/main.js"></script>
<!-- Page JS -->
<script src="js/dashboards-analytics.js"></script>
<script src="js/pages-account-settings-account.js"></script>
<!-- Myjs pour le spinnerWrapperEl d actualisation+mes script. -->
<script src="js/myJs.js"></script>
<!-- liens pour les websoket + Stom +Jquery. -->
<script src="js/jquery.min.js"></script>
<script src="js/sockjs.min.js"></script>
<script src="js/stomp.min.js" ></script>
<!-- le script des websoket notification. -->
<script src="js/notifWebSocket.js"></script>
<!-- Data table -->
<script src="js/datatables.min.js"></script>
<!--notif Js-->
<script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>

<script>
  //----- script pour les filtres
  var membreSelect = document.getElementById('membreSelect');
  const statutSelect = document.getElementById('statutSelect');
  var tbody = document.querySelector("#example tbody");
  var dateMinSelect = document.querySelector("#dateMinSelect");
  var dateMaxSelect = document.querySelector("#dateMaxSelect");
  var dateselect = document.querySelector("#dateSelected");
  var AllMyTask=[];
  var myTasksExcludingValidatedAndCancelled=[];
  var selectedStatuts=[""];
  var dateMax="";
  var utilisateurConnecte=[];
  var membres=[];
  var selectedDate="ouverture";

  getTasksExcludingValidatedAndCancelled();
  getAllMyTask();
  tacheParentes();
  dateOuvertureactuelle();

  function getAllMyTask(){
    fetch('getAllMyTask')
            .then(response => response.json())
            .then(data => {
              data.forEach(tache => {
                AllMyTask.push(tache);
              });
            })
  }

  //pour l affichage initial du table
  function getTasksExcludingValidatedAndCancelled(){
    fetch('getMyTasksExcludingValidatedAndCancelled')
            .then(response => response.json())
            .then(data => {
              // Redraw the table
              $('#example').DataTable().destroy();
              // For example, you can clear the table content
              tbody.innerHTML = '';
              data.forEach(tache => {
                myTasksExcludingValidatedAndCancelled.push(tache);
              });
              createTableRow(myTasksExcludingValidatedAndCancelled);
              datatableConf();
            })
  }

  // Fonction pour appliquer les filtres
  function applyFilters() {
    //update DataTable
    $('#example').DataTable().destroy();
    // supprimer le contenu du tableau
    tbody.innerHTML = '';
    const utilisateur = document.getElementById('membreSelect').value;
    const statut = document.getElementById('statutSelect').value;
    const etape = document.getElementById('etapeSelect').value;
    const dateType = document.getElementById('dateSelected').value;
    const dateMin = document.getElementById('dateMinSelect').value;
    const dateMax = document.getElementById('dateMaxSelect').value;
    var data =[];

    data =myTasksExcludingValidatedAndCancelled;
    if (statut) {
      data =[]
      data = AllMyTask;
    }
    // Filtrer les données
    const filteredData = data.filter(item => {
      const matchesUtilisateur = utilisateur ? item.utilisateur.idutilisateur == utilisateur : true;
      const matchesStatut = statut ? item.statut === statut : true;
      const matchesEtape = etape ? item.etape === etape : true;
      const matchesDate = dateType === "ouverture" ? item.dateouverture :
              dateType === "objectif" ? item.dateobjectif :
                      item.dateTermineTache;
      const matchesDateMin = dateMin ? new Date(matchesDate) >= new Date(dateMin) : true;
      const matchesDateMax = dateMax ? new Date(matchesDate) <= new Date(dateMax) : true;

      return matchesUtilisateur && matchesStatut && matchesEtape && matchesDateMin && matchesDateMax;
    });
    // Mettre à jour l'affichage avec les données filtrées
    createTableRow(filteredData);
    datatableConf();
  }

  // Écoutez les changements sur les filtres
  document.getElementById('membreSelect').addEventListener('change', applyFilters);
  document.getElementById('statutSelect').addEventListener('change', applyFilters);
  document.getElementById('etapeSelect').addEventListener('change', applyFilters);
  document.getElementById('dateSelected').addEventListener('change', applyFilters);
  document.getElementById('dateMinSelect').addEventListener('change', applyFilters);
  document.getElementById('dateMaxSelect').addEventListener('change', applyFilters);
  document.getElementById('rechercher').addEventListener('input', applyFilters);

  function progressPourcentage(tache) {
    var currentDate = new Date().toISOString().split('T')[0]; // Obtenir la date actuelle en format 'YYYY-MM-DD'
    var dateOuverture = new Date(tache.dateouverture);
    var dateObjectif = new Date(tache.dateobjectif);
    var currentDateObj = new Date(currentDate); // Convertir la date actuelle en objet Date
    // Vérifier si les dates d'ouverture et d'objectif sont identiques
    if (dateOuverture.getTime() === dateObjectif.getTime()) {return 100;}
    // Si la date actuelle est supérieure ou égale à la date d'objectif
    if (currentDateObj >= dateObjectif) {return 100;}
    var jr=(24 * 60 * 60 * 1000);
    // Calculer le pourcentage de progression
    var ecoule = (currentDateObj.getTime() - dateOuverture.getTime())+jr;
    var total = (dateObjectif.getTime() - dateOuverture.getTime())+jr;
    // Calculer le pourcentage et s'assurer qu'il ne dépasse pas 100%
    var pourcentage = (ecoule / total) * 100;
    return Math.min(Math.round(pourcentage), 100); // Arrondir et s'assurer que le pourcentage ne dépasse pas 100
    //return Math.min(pourcentage, 100); // Arrondir et s'assurer que le pourcentage ne dépasse pas 100
  }

  //fonction pours creer les linges de tableau
  function createTableRow(filteredData) {
    for (let i = 0; i < filteredData.length; i++) {
      // Créer une nouvelle ligne pour chaque tâche
      var newRow = document.createElement("tr");

      // Ajouter les cellules avec les données de la tâche à la nouvelle ligne
      var cellNomTache = document.createElement("td");
      cellNomTache.setAttribute("style"," display: flex;")
      cellNomTache.innerHTML = '     <p style="white-space: pre-wrap;margin: 0;max-width: 350px;min-height: 35px;height: auto">' + filteredData[i].nomtache + '</p>';
      newRow.appendChild(cellNomTache);

      var cellEtape = document.createElement("td");
      cellEtape.innerText = filteredData[i].etape != null ? filteredData[i].etape: 'Aucune';
      newRow.appendChild(cellEtape);

      var cellEmetteur = document.createElement("td");
      cellEmetteur.innerText = filteredData[i].utilisateur != null ? filteredData[i].utilisateur.prenom + ' ' + filteredData[i].utilisateur.nom : 'émetteur nul';
      newRow.appendChild(cellEmetteur);

      newRow.appendChild(createCelluleStatut(filteredData[i]));

      var cellDureeRetarde = document.createElement("td");
      if (filteredData[i].dureretarde > 0) {
        cellDureeRetarde.innerText = filteredData[i].dureretarde;
        newRow.appendChild(cellDureeRetarde);
      } else {
        cellDureeRetarde.innerText = "";
        newRow.appendChild(cellDureeRetarde);
      }

      var cellPerformance = document.createElement("td");
      cellPerformance.innerText = filteredData[i].performance + '%';
      newRow.appendChild(cellPerformance);

      var cellProgression = document.createElement("td");
      cellProgression.innerText = progressPourcentage(filteredData[i]) + '%';
      newRow.appendChild(cellProgression);

      var cellIdTache = document.createElement("td");
      cellIdTache.innerText = filteredData[i].idtache;
      newRow.appendChild(cellIdTache);

      var cellPriorite = document.createElement("td");
      cellPriorite.innerText = filteredData[i].priorite != null ? filteredData[i].priorite.nompriorite : 'Priorite nul';
      newRow.appendChild(cellPriorite);

      var cellDateOuverture = document.createElement("td");
      if (filteredData[i].dateouverture == null) {
        cellDateOuverture.innerText = '';
        newRow.appendChild(cellDateOuverture);
      } else {
        var dateOuverture = new Date(filteredData[i].dateouverture);
        var formattedDate =  ('0' + dateOuverture.getDate()).slice(-2) + '/' +('0' + (dateOuverture.getMonth() + 1)).slice(-2) + '/' + dateOuverture.getFullYear().toString().slice(-2);
        cellDateOuverture.innerText = formattedDate;
        newRow.appendChild(cellDateOuverture);
      }

      var cellDateObjectif = document.createElement("td");
      if (filteredData[i].dateobjectif == null) {
        cellDateObjectif.innerText = '';
        newRow.appendChild(cellDateObjectif);
      } else {
        var dateObjectif = new Date(filteredData[i].dateobjectif);
        var formattedDate =  ('0' + dateObjectif.getDate()).slice(-2) + '/' +('0' + (dateObjectif.getMonth() + 1)).slice(-2) + '/' + dateObjectif.getFullYear().toString().slice(-2);
        cellDateObjectif.innerText = formattedDate;
        newRow.appendChild(cellDateObjectif);
      }

      var cellDureeEstimee = document.createElement("td");
      cellDureeEstimee.innerText = filteredData[i].dureestime;
      newRow.appendChild(cellDureeEstimee);

      var cellDateCloture = document.createElement("td");
      if (filteredData[i].dateTermineTache == null) {
        cellDateCloture.innerText = '';
        newRow.appendChild(cellDateCloture);
      } else {
        var dateCloture = new Date(filteredData[i].dateTermineTache);
        var formattedDate =  ('0' + dateCloture.getDate()).slice(-2) +'/'+('0' + (dateCloture.getMonth() + 1)).slice(-2) +'/' +dateCloture.getFullYear().toString().slice(-2);
        cellDateCloture.innerText = formattedDate;
        newRow.appendChild(cellDateCloture);
      }


      // Ajouter la nouvelle ligne au corps du tableau
      var tableBody = document.querySelector("#example tbody");
      tableBody.appendChild(newRow);
    }
  }

  function createCelluleStatut(tache) {
    var cellStatut = document.createElement("td");
    cellStatut.classList.add("text-sm-center")
    var statutBadge = document.createElement("button");
    statutBadge.setAttribute("style","width: 100px !important");
    statutBadge.setAttribute("data-id", tache.idtache);
    statutBadge.className = "";
    statutBadge.addEventListener('click', () => modifyStatus(statutBadge));
    switch (tache.statut) {
      case "En cours":
        statutBadge.classList.add("btn","bg-info","badge","rounded-pill","capitalize-first");
        statutBadge.innerText = "En cours";
        break;
      case "Terminée":
        statutBadge.classList.add("btn","bg-success","badge","rounded-pill","capitalize-first");
        statutBadge.innerText = "Terminée";
        break;
      case "Programmée":
        statutBadge.classList.add("btn","bg-primary","badge","rounded-pill","capitalize-first");
        statutBadge.innerText = "Programmée";
        break;
      case "Validée":
        statutBadge.classList.add("btn","bg-secondary","badge","rounded-pill","capitalize-first");
        statutBadge.innerText = "Validée";
        break;
      case "À refaire":
        statutBadge.classList.add("btn","bg-danger","badge","rounded-pill","capitalize-first");
        statutBadge.innerText = "À refaire";
        break;
      case "En attente":
        statutBadge.classList.add("btn","bg-warning","badge","rounded-pill","capitalize-first");
        statutBadge.innerText = "En attente";
        break;
      case "Annulée":
        statutBadge.classList.add("btn","bg-dark","badge","rounded-pill","capitalize-first");
        statutBadge.setAttribute("style","color: white !important;width: 100px !important");
        statutBadge.innerText = "Annulée";
        break;
      default:
        statutBadge.innerText = "Statut inconnu";
    }
    statutBadge.classList.add("statutsClasse");
    cellStatut.appendChild(statutBadge);
    return cellStatut;
  }

  //Pour afficher les taches parentes dans la liste déroulante
  // dans le formulaire qui permet de créer une tâche
  // et actualiser la liste lorsqu'une indexation
  function tacheParentes() {
    $.ajax({
      url: `tachesParentes/`,
      method: 'GET',
      success: function (taches) {

        var tachesParentSelect = $("#tacheparente");
        tachesParentSelect.empty(); // Efface toutes les options actuelles
        tachesParentSelect.append (new Option("Selectionner la tâche parente",-1));
        for (var i = 0; i < taches.length; i++) {
          var option = new Option(taches[i].nomtache, taches[i].idtache);
          tachesParentSelect.append(option);
        }
      }
    });
  }

  function annuler() {
    // Récupérer l'élément du formulaire par son ID
    var formulaire = document.getElementById('formAccountSettings');
    var   btnSubmit= document.getElementById('submit');
    var inputEDateOuverture = document.getElementById("DateOuverture");

    // Vérifier si le formulaire a été trouvé
    if (formulaire) {
      // Réinitialiser le formulaire
      formulaire.reset();

      if ( btnSubmit.textContent === "Mettre à jour") {
        btnSubmit.textContent = "envoyer";}

      // Pre-select the Proprietaire in the dropdown
      const select1 = formulaire.querySelector("select[name='proprietaire']");
      select1.removeAttribute("readonly");
      select1.onmousedown = null;
      select1.style.cursor = "default";

      // Pre-select the Recepteur in the dropdown
      const select = formulaire.querySelector("select[name='recepteur']");
      select.removeAttribute("readonly");
      select.onmousedown = null;
      select.style.cursor = "default";

      //remove Disable editing and selection for nomtache
      const inputField = formulaire.querySelector(`input[name='nomtache']`);
      inputField.removeAttribute("readonly");
      inputField.onmousedown = null; // Supprimer l'événement onmousedown
      inputField.style.cursor = "text"; // Changer le style du curseur en mode édition

      const idTacheInput = formulaire.querySelector(`input[name='idtache']`);
      idTacheInput.value=null;
      idTacheInput.textContent="";

      // Disable editing and selection for tacheparente
      const selec = formulaire.querySelector("select[name='tacheparente']");
      selec.removeAttribute("readonly");
      selec.onmousedown = null;
      selec.style.cursor = "default";

      //Date d ouverture
      const inputEDateOuverture = formulaire.querySelector(`input[name='dateouverture']`);
      inputEDateOuverture.removeAttribute("readonly");
      inputEDateOuverture.onmousedown = null;
      inputEDateOuverture.style.cursor = "default";
      inputEDateOuverture.disabled=false;
      inputEDateOuverture.onmousedown = null; // Supprimer l'événement onmousedown
      //inputEDateOuverture.style.cursor = "text"; // Changer le style du curseur en mode édition
      dateOuvertureactuelle();
    } else {
      console.error('Le formulaire n\'a pas été trouvé.');
    }
  }

  //pour afficher la date d'ouverture
  function dateOuvertureactuelle(){
    //pour la date douverture
    // Obtenez la date actuelle au format YYYY-MM-DD
    var currentDate = new Date().toISOString().split('T')[0];
    // Mettez à jour l'attribut 'min' du champ de saisie de date avec la date actuelle
    document.getElementById('DateOuverture').min = currentDate;
    // Mettez à jour l'attribut 'value' du champ de saisie de date avec la date actuelle
    document.getElementById('DateOuverture').value = currentDate;
  }

  function datatableConf() {
    $(document).ready(function () {
      // Récupérer la pagination sauvegardée (ou utiliser 10 par défaut si aucune valeur)
      const savedLength = localStorage.getItem('datatableLength') || 10;

      var table = $('#example').DataTable({
        info: false,
        lengthMenu: [10, 25, 50],
        pageLength: parseInt(savedLength), // Appliquer la pagination sauvegardée
        language: {
          "lengthMenu": "Afficher _MENU_ entrées",
          "search": "Rechercher :",
          "paginate": {
            "first": "Première",
            "last": "Dernière",
            "next": "Suivant",
            "previous": "Précédent"
          }
        },
        dom: '<"top">t<"bottom"lp>',
        order: []
      });

      // Événement lorsque l'utilisateur change la pagination
      table.on('length.dt', function (e, settings, len) {
        localStorage.setItem('datatableLength', len); // Sauvegarder la pagination choisie
      });

      // Recherche en direct
      $('#rechercher').on('keyup', function () {
        table.search(this.value).draw();
      });
    });
  }


  /* function datatableConf(){
    $(document).ready(function () {
      var table = $('#example').DataTable({

        info: false,
        lengthMenu: [10, 25, 50],
        language: {
          "lengthMenu": "Afficher _MENU_ entrées",
          "search": "Rechercher :",
          "paginate": {
            "first": "Première",
            "last": "Dernière",
            "next": "Suivant",
            "previous": "Précédent"
          }
        },
        dom: '<"top">t<"bottom"lp>',
        order: []
      });

      $('#rechercher').on('keyup', function() {
        table.search(this.value).draw();
      });
    });
  }
  //fonction verifier si une liste contient valeur vide
     function contientValeurVide(liste) {
       // Vérifie chaque élément de la liste
       for (let i = 0; i < liste.length; i++) {
         // Si l'élément est vide (null, undefined ou une chaîne vide), retourne true
         if (liste[i] === null || liste[i] === undefined || liste[i] === '') {
           return true;
         }
       }
       // Si aucun élément vide n'est trouvé, retourne false
       return false;
     }

  function progressPourcentage(tache){
    var currentDate = new Date().toISOString().split('T')[0];
    if (tache.idtache==104) {
      console.log(currentDate );
      console.log(tache.dateouverture)
      console.log(tache.dateobjectif)
      console.log('wwwwwww');
    }
    if (tache.dateobjectif==tache.dateouverture){return 100;}
    if (currentDate>=tache.dateobjectif) {return 100;}
    else {
      return (currentDate-tache.dateouverture)/(tache.dateobjectif-tache.dateouverture)*100;
    }

  };

    //Trouver le role d utilisateur connecté
    function getRole(callback) {
      $.ajax({
        url: `Role`,
        method: 'GET',
        success: function (data) {
          utilisateurConnecte.push(data);
        },
        error: function (error) {
          console.error("Une erreur s'est produite lors de la récupération du rôle :", error);
        }
      });
    }
    getRole();

      // Appel de la fonction fetch pour récupérer les membres de l'équipe de l'utilisateur connecté
    fetch('membresDeLequipeDutilisateur', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        // Vous pouvez également ajouter des en-têtes supplémentaires si nécessaire
      },})
            .then(response => {
              if (!response.ok) {
                throw new Error('Erreur de réseau');
              }
              return response.json();
            })
            .then(data => {
              // Les données récupérées (liste de membres) sont stockées dans la variable data
              data.forEach(user=>{
                membres.push(user)
              })
            })
            .catch(error => {
              console.error('Erreur lors de la récupération des membres:', error);
            });
   */
</script>

</section>

</body>

</html>



