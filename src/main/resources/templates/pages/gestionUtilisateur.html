<!DOCTYPE html>

<!-- =========================================================
* Sneat - Bootstrap 5 HTML Admin Template - Pro | v1.0.0
==============================================================

* Product Page: https://themeselection.com/products/sneat-bootstrap-html-admin-template/
* Created by: ThemeSelection
* License: You must have a valid license purchased in order to legally use the theme for your project.
* Copyright ThemeSelection (https://themeselection.com)

=========================================================
 -->
<!-- beautify ignore:start -->
<html
        lang="en"
        class="light-style layout-menu-fixed"
        dir="ltr"
        data-theme="theme-default"
        data-assets-path="../assets/"
        data-template="vertical-menu-template-free"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout.html}"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security"

>
<head>
  <meta charset="utf-8" />
  <meta
          name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
  />

  <title>Do-it4me</title>

  <meta name="description" content="" />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="img/LDFLOGO.png" />

  <!-- Data table ikns-->
  <link href="css/datatables.min.css" rel="stylesheet">


  <!-- Icons. Uncomment required icon fonts -->
  <link rel="stylesheet" href="css/boxicons.css" />
  <link rel="stylesheet" href="css/boxicons.css" />
  <link rel="stylesheet" href="css/page-auth.css" />
  <!-- Core CSS -->
  <link rel="stylesheet" href="css/core.css" class="template-customizer-core-css" />
  <link rel="stylesheet" href="css/theme-default.css" class="template-customizer-theme-css" />
  <link rel="stylesheet" href="css/demo.css" />

  <!-- Vendors CSS -->
  <link rel="stylesheet" href="css/perfect-scrollbar.css" />

  <link rel="stylesheet" href="css/apex-charts.css" />
  <link rel="stylesheet" href="css/page-auth.css" />
  <!-- Page CSS -->

  <link rel="stylesheet" href="css/myCss.css" />
  <!-- Helpers -->
  <script src="js/helpers.js"></script>

  <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
  <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
  <script src="js/config.js"></script>
</head>
<body>

<section layout:fragment="content">

  <div class="d-flex justify-content-between ">
    <!--chemin-->
    <p class="fw-bold my-primary"  style="margin-left: 20px;">
        <span class="text-muted fw-light my-primary ">
         <i class="bx bx-cog " style="margin-right: 5px;"></i>
            Administration /</span>
      <i class="bx bx-group me-1"></i> Comptes
    </p>
    <!--/chemin-->
    <ul class="nav nav-pills flex-column flex-md-row " style="margin-right: 20px;">
      <li>
        <!-- Vertically Centered Modal -->
        <!-- Button trigger modal -->
        <button
                type="button"
                class="btn btn-sm me-1 mb-1 btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#modalCenter"
                id="creercompte"
                onclick="annuler()"
        >
          <i class="bx bx-add-to-queue me-1"></i> Créer un compte
        </button>
      </li>

    </ul>

  </div>

  <!-- content div-->
  <div class="container-fluid h-auto">
    <div class="content-wrapper">
      <!-- Content -->
      <div class="container-xxl flex-grow-1 " STYLE="padding-top: 0px;margin-top: 2px;padding:0px;">

        <div class="row">
          <div class="col-md-12">

            <!-- Modal -->
            <div class="modal fade" id="modalCenter" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                    ></button>
                  </div>
                  <div class="modal-body">
                    <form id="formAccountSettings" th:action="@{CreateUtilisateur}"  th:object="${utilisateur}" method="post" >
                      <input type="hidden" class="form-control" name="idutilisateur">
                      <div class="row">
                        <div class="mb-3 col-md-6">
                          <label for="firstName" class="form-label">nom</label>
                          <input
                                  class="form-control"
                                  type="text"
                                  id="firstName"
                                  name="nom"
                                  placeholder="nom"
                                  autofocus
                                  required="required"
                          />
                        </div>
                        <div class="mb-3 col-md-6">
                          <label for="firstName" class="form-label">prenom</label>
                          <input
                                  class="form-control"
                                  type="text"
                                  id="prenom"
                                  name="prenom"
                                  placeholder="prenom"
                                  required="required"
                          />
                        </div>
                        <div class="mb-3 col-md-6">
                          <label for="email" class="form-label">E-mail</label>
                          <input
                                  class="form-control"
                                  type="email"
                                  id="email"
                                  name="mail"
                                  placeholder="example@gmail.com"
                                  required="required"
                          />
                        </div>
                        <div class="mb-3 col-md-6">
                          <label  class="form-label">Mot De Passe</label>
                          <div class="input-group input-group-merge">
                            <input
                                    type="password"
                                    id="password"
                                    class="form-control"
                                    name="motdepasse"
                                    placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;"
                                    aria-describedby="password"
                            />
                            <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                          </div>
                        </div>
                        <div class="mb-3 col-md-6">
                          <label for="domaine" class="form-label">Service</label>
                          <select id="domaine"  class="select2 form-select" name="Domaine.iddomaine">
                            <option th:each="p:${domaineList}" th:value="${p.iddomaine}" th:text="${p.nomdomaine}" ></option>
                          </select>
                        </div>
                        <div class="mb-3 col-md-6">
                          <label for="societeSelect" class="form-label">Société</label>
                          <div   class="input-group">
                            <select required="required" class="form-select" id="societeSelect" name="Societe.idsociete">
                              <option value="" >Selectionnez une société</option>
                              <option th:each="p:${societeList}" th:value="${p.idsociete}" th:text="${p.nomsociete}"></option>
                            </select>
                          </div>
                        </div>

                        <div class="mb-3 col-md-6">
                          <label for="departementSelect" class="form-label">Departement</label>
                          <select id="departementSelect"  class="select2 form-select" name="Departement.iddepartement">
                            <!--les departement s'affiche quand tu selectione une societe (a partir de ajaxe ) voir le script dans MyScript.js   -->
                          </select>
                        </div>


                        <div class="mb-3 col-md-6">
                          <label for="language" class="form-label">Role</label>
                          <select  id="language" class="select2 form-select" name="Role.idrole">
                            <option th:each="p:${roles}" th:value="${p.idrole}" th:text="${p.role}"></option>
                          </select>
                        </div>

                        <div class="mb-3 col-md-6">
                          <label class="form-label" for="actif">Statut du compte : actif. </label>
                          <input id="actif" type="checkbox" checked  name="actif" >
                        </div>

                      </div>

                      <div class="mt-2">
                        <button type="submit" class="btn btn-primary me-2">Créer</button>
                        <button type="reset"
                                class="btn btn-outline-secondary"
                                onclick="annuler()"
                                data-bs-dismiss="modal"
                        >Annuler</button>
                        <!--<button type="button" class="btn btn-outline-secondary" >
                          Close
                        </button>-->
                      </div>
                    </form>
                  </div>

                </div>
              </div>
            </div>


          </div>

          <div class="card">
            <div class="card-body">
              <div  th:if="${not #strings.isEmpty(msg) or not #strings.isEmpty(msgError)  or not #strings.isEmpty(msg2) }" id="messages" class="mb-3 col-md-12">

                <div th:if="${not #strings.isEmpty(msg)}" class="form-group">
                  <div class="alert alert-success" th:text="${msg}"></div>
                </div>
                <div th:if="${not #strings.isEmpty(msgError)}" class="form-group">
                  <div class="alert alert-danger" th:text="${msgError}"></div>
                </div>
                <div th:if="${not #strings.isEmpty(msg2)}" class="form-group">
                  <div class="alert alert-success" th:text="${msg2}"></div>
                </div>
              </div>
              <div class="table-responsive text-nowrap">
                <!-- Extra Large Modal pour Creer une Tache -->
                <div class="modal fade" id="exLargeModal" tabindex="-1" aria-hidden="true" style="padding-top: 170px">
                  <div class="modal-dialog modal-xl" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">
                        <form id="formAccountSettings2" method="POST" th:action="@{CreateTache}">
                          <input type="hidden" class="form-control" name="idtache">
                          <input type="hidden" th:value="${utilisateurC.idutilisateur}" class="form-control"
                                 name="Utilisateur">
                          <input type="hidden" name="ismemoire" id="ismemoire" value="false" required/>

                          <div class="d-flex align-content-between justify-content-between flex-wrap  pr-0 pl-0">
                            <!-- Première div pour le destinataire -->
                            <div class="d-flex justify-content-evenly align-content-center">
                              <label for="idrecepteur" class="form-label align-content-center  "
                                     STYLE="margin-right: 15px;">Destinataire</label>
                              <select id="idrecepteur" name="recepteur" class="select2 form-select w-px-160" required>
                                <option th:each="p:${Recepteurs}" th:value="${p.idutilisateur}"
                                        th:text="${p.prenom + ' ' + p.nom}"></option>
                              </select>
                            </div>

                            <!-- Deuxième div pour la tâche à réaliser -->
                            <div class="d-flex justify-content-evenly">
                              <label for="nomtache" class="form-label align-content-center"
                                     STYLE="margin-right: 15px;">Tâche à réaliser</label>
                              <input type="text" class="form-control w-px-170" autofocus name="nomtache" id="nomtache" required>
                            </div>

                            <!-- Troisième div pour la durée estimée -->
                            <div class="d-flex justify-content-evenly">
                              <label class="form-label align-content-center" for="dureeEstimee"
                                     STYLE="margin-right: 15px;">EN</label>
                              <div class="d-flex">
                                <input type="number" placeholder="Durée Estimée " id="dureeEstimee" required min="1"
                                       name="dureestime" class="form-control w-50"/>
                                <label class="form-label align-content-center" for="dureeEstimee"
                                       STYLE="margin-left: 10px;">Jour(s)</label>
                              </div>
                            </div>
                          </div>

                          <br>
                          <div class="row g-3">

                            <div class="col mb-0">
                              <label for="idrecepteur" class="form-label align-content-center  "
                                     STYLE="margin-right: 15px;">Statut</label>
                              <select id="relationTypes" name="relationTypes" class="select2 form-select w-px-160" required>
                                <option th:each="p : ${relationTypes}" th:value="${p}">
                              <span th:text="${#strings.arrayContains(p.name(), 'SUBORDONNE') ? 'Subordonné' :
                                       #strings.arrayContains(p.name(), 'COLLEGUE') ? 'Collègue' :
                                       'Supérieur'}"></span>
                                </option>
                              </select>
                            </div>

                            <div class="col mb-0">
                              <label for="idrecepteur" class="form-label align-content-center  "
                                     STYLE="margin-right: 15px;">étape</label>
                              <select id="etape" name="etape" class="select2 form-select w-px-160" required>
                                <option>Aucune</option>
                                <option value="Cadrage">Cadrage</option>
                                <option value="Livraison">Livraison</option>
                                <option value="Embauche">Embauche</option>
                                <option value="Encaissement">Encaissement</option>
                              </select>
                            </div>

                            <div class="col mb-0">
                              <label for="Priorite" class="form-label">Priorité</label>
                              <select id="Priorite" class="select2 form-select" name="priorite" required>
                                <option th:each="p:${priorites}" th:value="${p.idpriorite}"
                                        th:text="${p.nompriorite}"></option>
                              </select>
                            </div>

                            <div class="col mb-0">
                              <label for="DateOuverture" class="form-label">Date Ouverture</label>
                              <input class="form-control" type="date" name="dateouverture" min="" id="DateOuverture"
                                     required>
                            </div>

                            <div class="col mb-0">
                              <label for="Proprietaires" class="form-label">Propriétaire</label>
                              <select id="Proprietaires" name="proprietaire" class="select2 form-select"
                                      required="required" th:with="selectedValue=${utilisateurC.idutilisateur}">
                                <option th:each="p:${utilisateurList2}" th:value="${p.idutilisateur}"
                                        th:selected="${selectedValue == p.idutilisateur}"
                                        th:text="${p.prenom + ' ' + p.nom}"></option>
                              </select>
                            </div>
                            <div class="col mb-0">
                              <label for="tacheparente" class="form-label">Tâche parente</label>
                              <select id="tacheparente" class="select2 form-select" name="tacheparente">
                                <!-- <option  value="">Selectionner la tâche parente</option>
                                 <option th:each="TacheParents:${lesTacheParents}" th:value="${TacheParents.idtache}" th:text="${TacheParents.nomtache}"></option>-->
                              </select>
                            </div>

                            <div class="col mb-0">
                              <label for="type" class="form-label">Type</label>
                              <select class="select2 form-select" required="required"  id="type" name="type">
                                <option value="Opérationnel">Opérationnel</option>
                                <option value="Projet">Projet</option>
                              </select>
                            </div>

                            <div class="col mb-0">
                              <label class="form-label" for="Aunetachesuccessive">Tâche indexée</label>
                              <select class="select2 form-select" required="required" id="Aunetachesuccessive" name="aunetachesuccessive">
                                <option value="false">Non</option>
                                <option value="true">Oui</option>
                              </select>
                            </div>

                            <div class="col mb-0" style="padding-top: 30px;">
                              <button type="submit" id="submit2" class="btn btn-primary "> Envoyer</button>
                              <button type="button"
                                      class="btn btn-outline-secondary"
                                      onclick="annuler2()"
                              >Annuler
                              </button>
                            </div>
                          </div>

                        </form>
                      </div>
                    </div>
                  </div>
                </div>
                <!--/ Extra Large Modal pour Creer une Tache -->

                <table class="table table-bordered table-sm table-secondary" id="example" style="width:100%">
                  <thead>
                  <tr>
                    <th class="capitalize-first Mycolor" >Nom</th>
                    <th class="capitalize-first Mycolor"  >prenom</th>
                    <th class="capitalize-first Mycolor" >Email</th>
                    <th class="capitalize-first Mycolor" >société</th>
                    <th  class="capitalize-first Mycolor" >departement</th>
                    <th  class="capitalize-first Mycolor" >Service</th>
                    <th class="capitalize-first Mycolor" >Role</th>
                    <th class="capitalize-first Mycolor" >Actif</th>
                    <th class="capitalize-first Mycolor" >Actions</th>
                  </tr>
                  </thead>
                  <tbody class="table-border">
                  <tr th:each="p:${utilisateurList}">
                    <td th:text="${p.nom}" ></td>
                    <td th:text="${p.prenom}"  ></td>
                    <td  th:text="${p.mail}" ></td>
                    <td th:text="${p.societe != null ? p.societe.nomsociete : ''}"></td>
                    <td th:text="${p.departement != null ? p.departement.nomdepartement : ''}"></td>
                    <td th:text="${p.domaine != null ? p.domaine.nomdomaine : ''}"></td>
                    <td th:text="${p.role != null ? p.role.role:''}"></td>
                    <td th:text="${p.actif == true  ? '✔':'✘'}"></td>
                    <td>
                      <div class="dropdown">
                        <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </button>
                        <div class="dropdown-menu">
                          <a class="dropdown-item"  th:attr="data-id=${p.idutilisateur}" onclick="editUtilisateur(this)"
                          ><i class="bx bx-edit-alt me-2"></i> Éditer</a
                          >
                          <a class="dropdown-item" onclick="confirmDelete(event)"  th:href="@{/deleteUtilisateur/{id}(id=${p.idutilisateur})}"
                          ><i class="bx bx-trash me-2"></i> Supprimer</a
                          >
                        </div>
                      </div>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
    <!-- /content-->
  </div>
  <!--/ content div-->



  <!-- Core JS -->
  <!-- build:js assets/vendor/js/core.js -->
  <script src="js/jquery.js"></script>
  <script src="js/popper.js"></script>
  <script src="js/bootstrap.js"></script>
  <script src="js/perfect-scrollbar.js"></script>

  <script src="js/menu.js"></script>
  <!-- endbuild -->

  <!-- Vendors JS -->
  <script src="js/apexcharts.js"></script>

  <!-- Main JS -->
  <script src="js/main.js"></script>

  <!-- Page JS -->
  <script src="js/dashboards-analytics.js"></script>
  <script src="js/pages-account-settings-account.js"></script>
  <script src="js/myJs.js"></script>
  <!-- liens pour les websoket + Stom . -->
  <script src="js/jquery.min.js"></script>
  <script src="js/sockjs.min.js"></script>
  <script src="js/stomp.min.js" ></script>
  <!-- le script des websoket notification. -->
  <script src="js/notifWebSocket.js"></script>

  <!-- Data table -->
  <script src="js/datatables.min.js"></script>
  <script src="js/MyDatatableConf.js"></script>

  <!--scripts-->
  <script type="text/javascript">





    //1--Pour filtrer les departements par societe
    $(document).ready(function() {
      $("#societeSelect").change(function() {
        var selectedSocieteId = $(this).val();
        if(selectedSocieteId=="")
        {
          document.getElementById("departementSelect").innerHTML = "";
        }
        updateDepartementOptions(selectedSocieteId);
      });

      function updateDepartementOptions(selectedSocieteId) {
        // Utilisez AJAX pour obtenir la liste des départements de la société sélectionnée depuis le serveur
        $.ajax({
          type: "GET",
          url: "get-departements-by-societe/" + selectedSocieteId, // Remplacez cette URL par votre endpoint
          success: function(data) {
            var departementSelect = $("#departementSelect");
            departementSelect.empty(); // Efface toutes les options actuelles

            // Ajoutez les nouvelles options basées sur les données reçues
            for (var i = 0; i < data.length; i++) {
              departementSelect.append(new Option(data[i].nomdepartement, data[i].iddepartement));
            }
          }
        });
      }
    });


    //2--Pour editer un utilisateur dans la meme formulaire
    function editUtilisateur(button) {

      afficherFormulaireCreeCompte();

      const idUtilisateur = button.getAttribute("data-id");
      const form = document.getElementById("formAccountSettings");

      // Set the idDepartement input field value and update the button text
      form.querySelector("input[name='idutilisateur']").value = idUtilisateur;
      form.querySelector("button[type='submit']").textContent = "Mettre à jour";

      // Fetch utilisateur details using AJAX
      $.ajax({
        type: "GET", // You may need to adjust this to your backend API
        url: `get-Utilisaeur/${idUtilisateur}`, // Replace with your API endpoint
        success: function(data) {
          // Assuming your API returns data in JSON format
          const nom = data.nom;
          const prenom = data.prenom;
          const motDepasse = data.motdepasse;
          const mail = data.mail;
          //console.log(data);

          // Pre-fill the form fields
          form.querySelector("input[name='nom']").value = nom;
          form.querySelector("input[name='prenom']").value = prenom;
          form.querySelector("input[name='motdepasse']").value = motDepasse;
          form.querySelector("input[name='mail']").value = mail;


          if (data.actif === false) {
            form.querySelector("input[name='actif']").removeAttribute("checked");
          } else {
            form.querySelector("input[name='actif']").setAttribute("checked", "checked");
          }

          // Pre-select the Societe in the dropdown
          const select3 = form.querySelector("select[name='Role.idrole']");

          if (data.role != null) {

            const RoleId = data.role.idrole;
            console.log(RoleId);
            const RoleOption2 = select3.querySelector(`option[value="${RoleId}"]`);
            //supprimer l'attribut selected de Societe
            RoleOption2.removeAttribute("selected");
            //donne la valeur selected pour l'attribut selected
            RoleOption2.setAttribute("selected", "selected");

          }


          // Pre-select the Societe in the dropdown
          const select2 = form.querySelector("select[name='Societe.idsociete']");

          //si l utilisateur a une societé
          if(data.societe!=null)
          {
            const SocieteId = data.societe.idsociete;
            const SocieteOption2 = select2.querySelector(`option[value="${SocieteId}"]`);
            //supprimer l'attribut selected de Societe
            SocieteOption2.removeAttribute("selected");
            //donne la valeur selected pour l'attribut selected
            SocieteOption2.setAttribute("selected", "selected");


            // Pre-select the Domaine in the dropdown
            const select = form.querySelector("select[name='Domaine.iddomaine']");
            //si l utilisateur a une societé
            if (data.domaine!=null)
            {
              const DomaineId = data.domaine.iddomaine;
              const DomaineOption = select.querySelector(`option[value="${DomaineId}"]`);
              //supprimer l'attribut selected du Domaine
              DomaineOption.removeAttribute("selected", "selected");
              //donne la valeur selected pour l'attribut selected
              DomaineOption.setAttribute("selected", "selected");
            }

            //si l utilisateur n'a aucune departement
            if (data.departement!=null)
            {
              //un variable pour stocke l'id de departement de l'utilisateur edité;
              const DepartementId = data.departement.iddepartement;

              //fonction pour parcourir les Departement de l utilisateur par l idSociete de lutilisateur edité;
              function updateDepartementOptions(SocieteId) {
                // Utilisez AJAX pour obtenir la liste des départements de la société sélectionnée depuis le serveur
                $.ajax({
                  type: "GET",
                  url: "get-departements-by-societe/" + SocieteId, //  endpoint
                  success: function(data1) {
                    var departementSelect = $("#departementSelect");
                    departementSelect.empty(); // Efface toutes les options actuelles

                    // Ajoutez les nouvelles options basées sur les données reçues
                    for (var i = 0; i < data1.length; i++) {
                      departementSelect.append(new Option(data1[i].nomdepartement, data1[i].iddepartement));
                      // si l'iddepartement de la societe de l utilisateur iditè = la departement de l utilisateur edité;
                      if( DepartementId==data1[i].iddepartement)
                      {// Pre-select the Departement in the dropdown
                        const select3 = form.querySelector("select[name='Departement.iddepartement']");
                        const DepartemenOption = select3.querySelector(`option[value="${DepartementId}"]`);
                        DepartemenOption.setAttribute("selected", "selected");
                      }
                    }
                  }
                });
              }
              updateDepartementOptions(SocieteId)
            }
            //si l utilisateur n'a acune departement
            else
            {
              //fonction pour parcourir les Departement de l utilisateur par l idSociete de lutilisateur edité;
              function updateDepartementOptions(SocieteId) {
                // Utilisez AJAX pour obtenir la liste des départements de la société sélectionnée depuis le serveur
                $.ajax({
                  type: "GET",
                  url: "get-departements-by-societe/" + SocieteId, //  endpoint
                  success: function(data1) {
                    var departementSelect = $("#departementSelect");
                    departementSelect.empty(); // Efface toutes les options actuelles

                    // Ajoutez les nouvelles options basées sur les données reçues
                    for (var i = 0; i < data1.length; i++) {
                      departementSelect.append(new Option(data1[i].nomdepartement, data1[i].iddepartement));
                    }
                  }
                });
              }
              updateDepartementOptions(SocieteId)
            }

          }


        },
        error: function(err) {
          // Handle the error if needed
          console.error(err);
        }
      });



    }

    function afficherFormulaireCreeCompte(){
      //pour afficher le form
      // Récupérer l'élément du bouton par son attribut 'class'
      var bouton = document.getElementById("creercompte");

      // Vérifier si le bouton a été trouvé
      if (bouton) {
        // Déclencher le clic sur le bouton
        bouton.click();
      } else {
        console.error('Le bouton n\'a pas été trouvé.');
      }

      //srcipt permet de défiler la page vers le haut lorsque l'utilisateur clique sur un bouton
      // Faites défiler la page vers le haut
      window.scrollTo({
        top: 0, // La position en pixels en haut de la page
        behavior: "smooth" // Option pour un défilement fluide
      });
    }

    function annuler()
    {
      // Récupérer l'élément du formulaire par son ID
      var formulaire = document.getElementById('formAccountSettings');

      // Vérifier si le formulaire a été trouvé
      if (formulaire) {
        // Réinitialiser le formulaire
        formulaire.reset();

        if ( formulaire.querySelector("button[type='submit']").textContent === "Mettre à jour") {
          formulaire.querySelector("button[type='submit']").textContent = "Créer";}

        const idTacheInput = formulaire.querySelector(`input[name='idutilisateur']`);
        idTacheInput.value=null;
        idTacheInput.textContent="";

      } else {
        console.error('Le formulaire n\'a pas été trouvé.');
      }
    }



    //--------------------pour le formulaire Creer une tâche
    //Pour afficher les taches parentes dans
    // la selelecte dans le formulaire qui permet de creer une tache et actualiser la liste lorsqu'une indexation
    tacheParentes();
    function tacheParentes() {
      $.ajax({
        url: `tachesParentes/`,
        method: 'GET',
        success: function (taches) {

          var tachesParentSelect = $("#tacheparente");
          tachesParentSelect.empty(); // Efface toutes les options actuelles
          tachesParentSelect.append (new Option("Selectionner la tâche parente",-1));
          for (var i = 0; i < taches.length; i++) {
            var option = new Option(taches[i].nomtache, taches[i].idtache);
            tachesParentSelect.append(option);
          }
        }
      });
    }

    function annuler2() {

      // Récupérer l'élément du formulaire par son ID
      var formulaire = document.getElementById('formAccountSettings2');
      var   btnSubmit= document.getElementById('submit2');
      var inputEDateOuverture = document.getElementById("DateOuverture");

      // Vérifier si le formulaire a été trouvé
      if (formulaire) {
        // Réinitialiser le formulaire
        formulaire.reset();

        if ( btnSubmit.textContent === "Mettre à jour") {btnSubmit.textContent = "Envoyer";}

        // Pre-select the Proprietaire in the dropdown
        const select1 = formulaire.querySelector("select[name='proprietaire']");
        select1.removeAttribute("readonly");
        select1.onmousedown = null;
        select1.style.cursor = "default";

        // Pre-select the Recepteur in the dropdown
        const select = formulaire.querySelector("select[name='recepteur']");
        select.removeAttribute("readonly");
        select.onmousedown = null;
        select.style.cursor = "default";

        //remove Disable editing and selection for nomtache
        const inputField = formulaire.querySelector(`input[name='nomtache']`);
        inputField.removeAttribute("readonly");
        inputField.onmousedown = null; // Supprimer l'événement onmousedown
        inputField.style.cursor = "text"; // Changer le style du curseur en mode édition

        const idTacheInput = formulaire.querySelector(`input[name='idtache']`);
        idTacheInput.value=null;
        idTacheInput.textContent="";


        // Disable editing and selection for tacheparente
        const selec = formulaire.querySelector("select[name='tacheparente']");
        selec.removeAttribute("readonly");
        selec.onmousedown = null;
        selec.style.cursor = "default";

        //Date d ouverture
        const inputEDateOuverture = formulaire.querySelector(`input[name='dateouverture']`);
        inputEDateOuverture.removeAttribute("readonly");
        inputEDateOuverture.onmousedown = null;
        inputEDateOuverture.style.cursor = "default";
        inputEDateOuverture.disabled=false;
        inputEDateOuverture.onmousedown = null; // Supprimer l'événement onmousedown
        //inputEDateOuverture.style.cursor = "text"; // Changer le style du curseur en mode édition
        dateOuvertureactuelle();
      } else {
        console.error('Le formulaire n\'a pas été trouvé.');
      }
    }

    //pour regler la douverture
    dateOuvertureactuelle();
    function dateOuvertureactuelle(){
      //pour la date douverture
      // Obtenez la date actuelle au format YYYY-MM-DD
      var currentDate = new Date().toISOString().split('T')[0];

      // Mettez à jour l'attribut 'min' du champ de saisie de date avec la date actuelle
      document.getElementById('DateOuverture').min = currentDate;

      // Mettez à jour l'attribut 'value' du champ de saisie de date avec la date actuelle
      document.getElementById('DateOuverture').value = currentDate;
    }

    // Sélectionnez tous les éléments avec la classe "show-message"
    var messageElements = document.querySelectorAll('.show-message');

    // Parcourir chaque élément et ajouter la classe "show" (pour l'animation)
    messageElements.forEach(function(element) {
      element.classList.add('show');

      // Supprimer la classe "show" après 5 secondes
      setTimeout(function() {
        element.classList.remove('show');
      }, 5000);
    });
    // Sélectionnez l'élément avec l'id "messages"
    var messagesDiv = document.getElementById("messages");

    // Supprimez la div après 5 secondes (5000 millisecondes)
    setTimeout(function() {
      if (messagesDiv) {
        messagesDiv.remove();
      }
    }, 5500);




  </script>


</section>


</body>

