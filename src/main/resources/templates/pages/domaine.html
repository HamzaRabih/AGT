<!DOCTYPE html>

<html
        lang="en"
        class="light-style layout-menu-fixed"
        dir="ltr"
        data-theme="theme-default"
        data-assets-path="../assets/"
        data-template="vertical-menu-template-free"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout.html}"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security"

>
<head>
    <meta charset="utf-8" />
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <title>Do-it4me</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico" />

    <!-- Data table ikns-->
    <link href="css/datatables.min.css" rel="stylesheet">


    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="css/boxicons.css" />
    <link rel="stylesheet" href="css/boxicons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="css/perfect-scrollbar.css" />

    <link rel="stylesheet" href="css/apex-charts.css" />

    <!-- Page CSS -->
    <link rel="stylesheet" href="css/myCss.css" />

    <!-- Helpers -->
    <script src="js/helpers.js"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="js/config.js"></script>
</head>


<body>

<section layout:fragment="content">

    <div class="d-flex justify-content-between">

        <!--chemin-->
        <P class="fw-bold  my-primary "  style="margin-left: 20px;">
        <span class="text-muted fw-light my-primary">
         <i class="bx bx-cog" style="margin-right: 5px;"></i>
            Administration /</span>
            <i class="bx bx-briefcase me-1"></i>Services
        </P>
        <!--/chemin-->


        <ul class="nav nav-pills flex-column flex-md-row " style="margin-right: 20px;">
            <li>
                <!-- Vertically Centered Modal -->
                <!-- Button trigger modal -->
                <button
                        type="button"
                        class="btn btn-sm  me-1 mb-1  btn-primary"
                        data-bs-toggle="modal"
                        data-bs-target="#modalCreateDomaine"
                        id="creerDomaine"

                >
                    <i class="bx bx-add-to-queue me-1"></i> Créer un Service
                </button>
            </li>

        </ul>

    </div>
    <!-- content div-->
    <div class="container-fluid h-auto">
        <div class="content-wrapper">

            <!-- Content -->
            <div class="container-xxl flex-grow-1 " STYLE="padding-top: 0px;margin-top: 2px;padding:0px;">

                <div class="row">

                    <div class="col-md-12">
                        <!-- Modal -->
                        <div class="modal fade" id="modalCreateDomaine" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button
                                                type="button"
                                                class="btn-close"
                                                data-bs-dismiss="modal"
                                                aria-label="Close"
                                        ></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="formCreateDomaine" th:action="@{/CreateDomaine}" class="form-group" method="post">
                                            <input type="hidden" class="form-control" name="iddomaine">
                                            <div class="row mb-3">
                                                <label class="col-sm-2 col-form-label my-primary" for="basic-icon-default-fullname">Service</label>
                                                <div class="col-sm-10">
                                                    <div class="input-group input-group-merge">
                                                        <span id="basic-icon-default-fullname2" class="input-group-text"><i class="bx bx-briefcase"></i></span>
                                                        <input type="text" class="form-control" id="basic-icon-default-fullname" placeholder="info..."
                                                               name="nomdomaine" required>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <label class="col-sm-2 col-form-label my-primary" for="basic-icon-default-company">Description:</label>
                                                <div class="col-sm-10">
                                                    <div class="input-group input-group-merge">
                                                        <span id="basic-icon-default-company2" class="input-group-text"><i class="bx bxs-message-rounded"></i></span>
                                                        <input type="text" id="basic-icon-default-company" class="form-control" name="description">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row justify-content-end">
                                                <div class="col-sm-10">
                                                    <button type="submit" class="btn btn-primary">Créer</button>
                                                    <button type="reset"
                                                            class="btn btn-outline-secondary"
                                                            onclick="annuler()"
                                                            data-bs-dismiss="modal"
                                                    >Annuler</button>
                                                    <!--<button type="button" class="btn btn-outline-secondary" >
                                                      Close
                                                    </button>-->
                                                </div>
                                        </form>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Basic Bootstrap Table -->
                    <div class="card">
                        <div class="card-body">
                            <div th:if="${not #strings.isEmpty(msg) or not #strings.isEmpty(msgError)  or not #strings.isEmpty(msg1) }" id="messages" class="mb-3 col-md-12">
                                <div th:if="${not #strings.isEmpty(msg)}" class="form-group">
                                    <div class="alert alert-success" th:text="${msg}"></div>
                                </div>
                                <div th:if="${not #strings.isEmpty(msgError)}" class="form-group">
                                    <div class="alert alert-danger" th:text="${msgError}"></div>
                                </div>
                                <div th:if="${not #strings.isEmpty(msg1)}" class="form-group">
                                    <div class="alert alert-success" th:text="${msg1}"></div>
                                </div>
                            </div>
                            <div class="table-responsive text-nowrap">

                                <table class="table table-bordered table-sm table-secondary" id="example" style="width:100%">
                                    <thead>
                                    <tr>
                                        <th  class="capitalize-first Mycolor" >Service</th>
                                        <th  class="capitalize-first Mycolor" >Description</th>
                                        <th class="capitalize-first Mycolor" >Action</th>
                                    </tr>
                                    </thead>
                                    <tbody class="table-border">
                                    <tr th:each="p:${domaineList}">
                                        <td th:text="${p.nomdomaine}"></td>
                                        <td th:text="${p.description}"></td>
                                        <td>
                                            <div class="dropdown">
                                                <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                                                    <i class="bx bx-dots-vertical-rounded"></i>
                                                </button>
                                                <div class="dropdown-menu">
                                                    <a class="dropdown-item" th:attr="data-id=${p.iddomaine}" onclick="editDomaine(this)"
                                                    ><i class="bx bx-edit-alt me-2"></i> Éditer</a>
                                                    <a class="dropdown-item" onclick="confirmDelete(event)" th:href="@{/deleteDomaine/{id}(id=${p.iddomaine})}"
                                                    ><i class="bx bx-trash me-2"></i> Supprimer</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!--/ Basic Bootstrap Table -->

                </div>
                <!-- /content-->
            </div>
            <!--/ content div-->


            <!-- Core JS -->
            <!-- build:js assets/vendor/js/core.js -->
            <script src="js/jquery.js"></script>
            <script src="js/popper.js"></script>
            <script src="js/bootstrap.js"></script>
            <script src="js/perfect-scrollbar.js"></script>

            <script src="js/menu.js"></script>
            <!-- endbuild -->

            <!-- Vendors JS -->
            <script src="js/apexcharts.js"></script>

            <!-- Main JS -->
            <script src="js/main.js"></script>

            <!-- Page JS -->
            <script src="js/dashboards-analytics.js"></script>
            <script src="js/pages-account-settings-account.js"></script>
            <!-- liens pour les websoket + Stom . -->
            <script src="js/sockjs.min.js"></script>
            <script src="js/stomp.min.js" ></script>
            <!-- le script des websoket notification. -->
            <script src="js/notifWebSocket.js"></script>
            <!-- Data table -->
            <script src="js/myJs.js"></script>
            <script src="js/jquery.min.js"></script>
            <script src="js/datatables.min.js"></script>
            <script src="js/MyDatatableConf.js"></script>

            <script>
                function editDomaine(button) {
                    const idDomaine = button.getAttribute("data-id");
                    const form = document.getElementById("formCreateDomaine");

                    // Set the idDomaine input field value and update the button text
                    form.querySelector("input[name='iddomaine']").value = idDomaine;
                    form.querySelector("button[type='submit']").textContent = "Mettre à jour";



                    // Fetch Domaine details using AJAX
                    $.ajax({
                        type: "GET", // You may need to adjust this to your backend API
                        url: `get-Domaine/${idDomaine}`, // Replace with your API endpoint
                        success: function(data) {
                            // Assuming your API returns data in JSON format
                            const nomDomaine = data.nomdomaine;
                            const description = data.description;

                            // Pre-fill the form fields
                            form.querySelector("input[name='nomdomaine']").value = nomDomaine;
                            form.querySelector("input[name='description']").value = description;
                        },
                        error: function(err) {
                            // Handle the error if needed
                            console.error(err);
                        }
                    });

                    //pour afficher le form
                    // Récupérer l'élément du bouton par son attribut 'class'
                    var bouton = document.getElementById("creerDomaine");

                    // Vérifier si le bouton a été trouvé
                    if (bouton) {
                        // Déclencher le clic sur le bouton
                        bouton.click();
                    } else {
                        console.error('Le bouton n\'a pas été trouvé.');
                    }



                    //srcipt permet de défiler la page vers le haut lorsque l'utilisateur clique sur un bouton
                    // Faites défiler la page vers le haut
                    window.scrollTo({
                        top: 0, // La position en pixels en haut de la page
                        behavior: "smooth" // Option pour un défilement fluide
                    });
                }




                function annuler()
                {
                    // Récupérer l'élément du formulaire par son ID
                    var formulaire = document.getElementById('formCreateDomaine');

                    // Vérifier si le formulaire a été trouvé
                    if (formulaire) {
                        // Réinitialiser le formulaire
                        formulaire.reset();

                        if ( formulaire.querySelector("button[type='submit']").textContent === "Mettre à jour") {
                            formulaire.querySelector("button[type='submit']").textContent = "Créer";

                            const idTacheInput = formulaire.querySelector(`input[name='iddomaine']`);
                            idTacheInput.value=null;
                            idTacheInput.textContent="";

                        }
                        dateOuvertureactuelle();
                    } else {
                        console.error('Le formulaire n\'a pas été trouvé.');
                    }
                }


                // Sélectionnez tous les éléments avec la classe "show-message"
                var messageElements = document.querySelectorAll('.show-message');

                // Parcourir chaque élément et ajouter la classe "show" (pour l'animation)
                messageElements.forEach(function(element) {
                    element.classList.add('show');

                    // Supprimer la classe "show" après 5 secondes
                    setTimeout(function() {
                        element.classList.remove('show');
                    }, 5000);
                });
                // Sélectionnez l'élément avec l'id "messages"
                var messagesDiv = document.getElementById("messages");

                // Supprimez la div après 5 secondes (5000 millisecondes)
                setTimeout(function() {
                    if (messagesDiv) {
                        messagesDiv.remove();
                    }
                }, 5500);

                //--------------------pour le formulaire Creer une tâche
                //Pour afficher les taches parentes dans
                // la selelecte dans le formulaire qui permet de creer une tache et actualiser la liste lorsqu'une indexation
                tacheParentes();
                function tacheParentes() {
                    $.ajax({
                        url: `tachesParentes/`,
                        method: 'GET',
                        success: function (taches) {

                            var tachesParentSelect = $("#tacheparente");
                            tachesParentSelect.empty(); // Efface toutes les options actuelles
                            tachesParentSelect.append (new Option("Selectionner la tâche parente",-1));
                            for (var i = 0; i < taches.length; i++) {
                                var option = new Option(taches[i].nomtache, taches[i].idtache);
                                tachesParentSelect.append(option);
                            }
                        }
                    });
                }

                function annuler2() {
                    // Récupérer l'élément du formulaire par son ID
                    var formulaire = document.getElementById('formCreateDomaine2');
                    var   btnSubmit= document.getElementById('submit2');
                    var inputEDateOuverture = document.getElementById("DateOuverture");

                    // Vérifier si le formulaire a été trouvé
                    if (formulaire) {
                        // Réinitialiser le formulaire
                        formulaire.reset();

                        if ( btnSubmit.textContent === "Mettre à jour") {btnSubmit.textContent = "Envoyer";}

                        // Pre-select the Proprietaire in the dropdown
                        const select1 = formulaire.querySelector("select[name='proprietaire']");
                        select1.removeAttribute("readonly");
                        select1.onmousedown = null;
                        select1.style.cursor = "default";

                        // Pre-select the Recepteur in the dropdown
                        const select = formulaire.querySelector("select[name='recepteur']");
                        select.removeAttribute("readonly");
                        select.onmousedown = null;
                        select.style.cursor = "default";

                        //remove Disable editing and selection for nomtache
                        const inputField = formulaire.querySelector(`input[name='nomtache']`);
                        inputField.removeAttribute("readonly");
                        inputField.onmousedown = null; // Supprimer l'événement onmousedown
                        inputField.style.cursor = "text"; // Changer le style du curseur en mode édition

                        const idTacheInput = formulaire.querySelector(`input[name='idtache']`);
                        idTacheInput.value=null;
                        idTacheInput.textContent="";


                        // Disable editing and selection for tacheparente
                        const selec = formulaire.querySelector("select[name='tacheparente']");
                        selec.removeAttribute("readonly");
                        selec.onmousedown = null;
                        selec.style.cursor = "default";

                        //Date d ouverture
                        const inputEDateOuverture = formulaire.querySelector(`input[name='dateouverture']`);
                        inputEDateOuverture.removeAttribute("readonly");
                        inputEDateOuverture.onmousedown = null;
                        inputEDateOuverture.style.cursor = "default";
                        inputEDateOuverture.disabled=false;
                        inputEDateOuverture.onmousedown = null; // Supprimer l'événement onmousedown
                        //inputEDateOuverture.style.cursor = "text"; // Changer le style du curseur en mode édition
                        dateOuvertureactuelle();
                    } else {
                        console.error('Le formulaire n\'a pas été trouvé.');
                    }

                }

                //pour regler la douverture
                dateOuvertureactuelle();
                function dateOuvertureactuelle(){
                    //pour la date douverture
                    // Obtenez la date actuelle au format YYYY-MM-DD
                    var currentDate = new Date().toISOString().split('T')[0];

                    // Mettez à jour l'attribut 'min' du champ de saisie de date avec la date actuelle
                    document.getElementById('DateOuverture').min = currentDate;

                    // Mettez à jour l'attribut 'value' du champ de saisie de date avec la date actuelle
                    document.getElementById('DateOuverture').value = currentDate;
                }

            </script>

</section>


</body>
</html>
